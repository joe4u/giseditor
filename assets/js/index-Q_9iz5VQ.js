var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;import{bi as s,bj as u,b7 as c}from"./vendor-CeW-n8KA.js";import{r as f}from"./lodash-CpWKv_2Z.js";const l={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31},p={C:254,L:1,D:8,N:18,M:18,F:18,B:8};var y={string:"C",number:"N",boolean:"L",null:"C"};function h(e){var t={};return e.forEach(function(e){!function(e,t){for(var n in t){var r=void 0!==t[n]&&null!==t[n];(void 0===e[n]||r)&&(e[n]=t[n])}}(t,e)}),function(e){var t={},n=[];for(var r in e)t[r]=null===e[r]?"null":typeof e[r];for(var o in t){var i=y[t[o]];i&&n.push({name:o,type:i,size:p[i]})}return n}(t)}const g={encoding:"gb18030"};function m(e,t,n="gb18030"){var r=h(e),o=32*r.length+1,i=r.reduce(function(e,t){return e+t.size},1),a=new ArrayBuffer(o+32+i*e.length+1),u=new Date,c=new DataView(a);!function(e){e&&(g.encoding=e)}(n),function(e){e.forEach(e=>{switch(e.type){case"C":e.size=Math.min(e.size&&e.size>0?e.size:10,255);break;case"N":e.size=Math.min(e.size&&e.size>0?e.size:10,20),e.precision=Math.min(e.precision&&e.precision>=0?e.precision:0,19);break;case"D":e.size=8;break;case"L":e.size=1;break;default:throw new Error("Type must be one of C, N, L, D")}})}(r),c.setUint8(0,3),c.setUint8(1,u.getFullYear()-1900),c.setUint8(2,u.getMonth()+1),c.setUint8(3,u.getDate()),c.setUint32(4,e.length,!0);var l=o+32;c.setUint16(8,l,!0),c.setUint16(10,i,!0),r.forEach(function(e,t){!function(e,t,n){s.encode(n,g.encoding).forEach((n,r)=>{r>=11||e.setUint8(t+r,n)})}(c,32+32*t,e.name),c.setInt8(32+32*t+11,e.type.charCodeAt(0)),c.setInt8(32+32*t+16,e.size),"N"==e.type&&c.setInt8(32+32*t+17,3)}),c.setInt8(32+o-1,13);var p=o+32;return e.forEach(function(e){c.setUint8(p,32),p++,r.forEach(function(t){var n=e[t.name];switch(null==n&&("C"===t.type&&(n=""),"N"===t.type&&(n=0),"D"===t.type&&(n=u),"L"===t.type&&(n=null)),t.type){case"L":c.setUint8(p,!0===n?84:!1===n?70:63),p++;break;case"D":p=function(e,t,n){let r="19000001";f.isDate(n)?r=`${1e4*n.getFullYear()+100*n.getMonth()+100+n.getDate()}`:f.isString(n)&&(r=n.substr(0,8));return I(e,t,r,8)}(c,p,n);break;case"N":p=function(e,t,n,r,o){return n=new Number(n).toFixed(r||0),b(s.encode(n,"ASCII"),o,false).forEach((n,r)=>{e.setUint8(t+r,n)}),t+o}(c,p,n,t.precision,t.size);break;case"C":p=I(c,p,n,t.size);break;default:throw new Error(`Unknown field type: ${t.type}`)}})}),c.setUint8(p,26),c}function b(e,t,n=!0){let r=new Uint8Array(new ArrayBuffer(t)),o=e.length>t?t:e.length,i=t-o;if(n){for(let t=0;t<o;t++)r[t]=e[t];for(let e=0;e<i;e++)r[o+e]=32}else{for(let e=0;e<i;e++)r[e]=32;for(let t=0;t<o;t++)r[i+t]=e[t]}return r}function I(e,t,n,r){return b(s.encode(n,g.encoding),r,!0).forEach((n,r)=>{e.setUint8(t+r,n)}),t+r}const d='GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]',L=function(e,t){return t[0]<e.xmin&&(e.xmin=t[0]),t[0]>e.xmax&&(e.xmax=t[0]),t[1]<e.ymin&&(e.ymin=t[1]),t[1]>e.ymax&&(e.ymax=t[1]),e},O=function(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE}};function w(e,t){var n=1;return t!==l.POLYGON&&t!==l.POLYLINE||(n=e.reduce(function(e,t){return e+=t.length,Array.isArray(t[0][0][0])&&(e+=t.reduce(function(e,t){return e+t.length-1},0)),e},0)),n}function v(e,t){return void 0===t&&(t=[]),"object"==typeof e[0][0]?e.reduce(function(e,t){return e.concat(v(t))},t):e}const N=Object.freeze(Object.defineProperty({__proto__:null,extent:function(e){return v(e).reduce(function(e,t){return L(e,t)},O())},parts:w,shpLength:function(e){return 56*e.length+16*v(e).length},shxLength:function(e){return 8*e.length},totalPoints:function(e){var t=0;return e.forEach(function(e){t+=e.length}),t},write:function(e,t,n,r,o){var i=0,a=0,s=100;e.forEach(function(e,t){var u=v(e),c=w([e],o),f=16*u.length+48+4*(c-1),l=u.reduce(function(e,t){return L(e,t)},O());r.setInt32(a,s/2),r.setInt32(a+4,f/2),a+=8,s+=f+8,n.setInt32(i,t+1),n.setInt32(i+4,f/2),n.setInt32(i+8,o,!0),n.setFloat64(i+12,l.xmin,!0),n.setFloat64(i+20,l.ymin,!0),n.setFloat64(i+28,l.xmax,!0),n.setFloat64(i+36,l.ymax,!0),n.setInt32(i+44,c,!0),n.setInt32(i+48,u.length,!0),n.setInt32(i+52,0,!0);for(var p=e.reduce(function(e,t){return Array.isArray(t[0][0])?e=e.concat(t):e.push(t),e},[]),y=1;y<c;y++)n.setInt32(i+52+4*y,p.reduce(function(e,t,n){return n<y?e+t.length:e},0),!0);u.forEach(function(e,t){n.setFloat64(i+56+16*t+4*(c-1),e[0],!0),n.setFloat64(i+56+16*t+4*(c-1)+8,e[1],!0)}),i+=f+8})}},Symbol.toStringTag,{value:"Module"}));var P={1:Object.freeze(Object.defineProperty({__proto__:null,extent:function(e){return e.reduce(function(e,t){return L(e,t)},O())},parts:function(e,t){return e.length},shpLength:function(e){return 28*e.length},shxLength:function(e){return 8*e.length},write:function(e,t,n,r){var o=100,i=0,a=0;e.forEach(function(e,t){n.setInt32(i,t+1),n.setInt32(i+4,10),n.setInt32(i+8,1,!0),n.setFloat64(i+12,e[0],!0),n.setFloat64(i+20,e[1],!0),r.setInt32(a,o/2),r.setInt32(a+4,10),a+=8,i+=28,o+=28})}},Symbol.toStringTag,{value:"Module"})),5:N,3:N};function x(e,t){e.setInt32(0,9994),e.setInt32(28,1e3,!0),e.setInt32(32,t,!0)}function E(e,t){t.setFloat64(36,e.xmin,!0),t.setFloat64(44,e.ymin,!0),t.setFloat64(52,e.xmax,!0),t.setFloat64(60,e.ymax,!0)}const A=j("Point","POINT"),U=j("LineString","POLYLINE"),M=j("MultiLineString","POLYLINE"),D=j("Polygon","POLYGON"),T=j("MultiPolygon","POLYGON");function j(e,t){return function(n){var r,o=n.features.filter((r=e,Array.isArray(r)?function(e){return r.includes(e.geometry.type)}:function(e){return e.geometry.type===r}));return{geometries:o.map(z),properties:o.map(F),type:t}}}function z(e){return e.geometry.coordinates}function F(e){return e.properties}function _(e,s,c=!1){let f=new u,p=f;s&&s.folder&&(p=f.folder(s.folder));var y=s&&s.prj?s.prj:d;[A(e),U(e),D(e),T(e),M(e)].forEach(function(e){var t,n,r,o,i,a,u,c,f,h,g,b,I;e.geometries.length&&e.geometries[0].length&&(t=e.properties,n=e.type,r=e.geometries,o=function(t,n){var r=s&&s.types&&s.types[e.type.toLowerCase()]?s.types[e.type.toLowerCase()]:e.type;p.file(r+".shp",n.shp.buffer,{binary:!0}),p.file(r+".shx",n.shx.buffer,{binary:!0}),p.file(r+".dbf",n.dbf.buffer,{binary:!0}),p.file(r+".prj",y),p.file(r+".cpg","GBK")},u=100+4*((a=P[i=l[n]]).parts(r,i)-r.length)+a.shpLength(r),c=100+a.shxLength(r),f=new ArrayBuffer(u),h=new DataView(f),g=new ArrayBuffer(c),b=new DataView(g),I=a.extent(r),x(h,i),x(b,i),E(I,h),E(I,b),a.write(r,I,new DataView(f,100),new DataView(g,100),i),h.setInt32(24,u/2),b.setInt32(24,50+4*r.length),o(null,{shp:h,shx:b,dbf:m(t),prj:d}))});var h,g={};return s&&s.outputType?g.type=s.outputType:g.type="base64",s&&s.compression?g.compression=s.compression:g.compression="DEFLATE",c?f.generateNodeStream((h=((e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(r)for(var n of r(t))i.call(t,n)&&a(e,n,t[n]);return e})({},g),t(h,n({streamFiles:!0})))):f.generateAsync(g)}function S(e,t){let n="download";t&&(t.filename||t.folder)&&(n=t.filename||t.folder),_(e,t).then(function(e){c.saveAs(e,n+".zip")})}export{S as download,_ as zip};
